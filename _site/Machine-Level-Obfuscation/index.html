<!DOCTYPE html>
<html>
  <head>
    <title>Machine level obfuscation – Aseem Raj Baranwal</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Let’s start with this beautiful piece of code in C. What do you think it does ?

" />
    <meta property="og:description" content="Let’s start with this beautiful piece of code in C. What do you think it does ?

" />
    
    <meta name="author" content="Aseem Raj Baranwal" />

    
    <meta property="og:title" content="Machine level obfuscation" />
    <meta property="twitter:title" content="Machine level obfuscation" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Aseem Raj Baranwal - Programmer and tech enthusiast" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://pbs.twimg.com/profile_images/709021635634802689/RTmLV2lw.jpg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Aseem Raj Baranwal</a></h1>
            <p class="site-description">Programmer and tech enthusiast</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/projects">Projects</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Machine level obfuscation</h1>

  <div class="entry" style="text-align:justify;">
    <p>Let’s start with this beautiful piece of code in C. What do you think it does ?</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">double</span> <span class="n">d</span><span class="p">[]</span><span class="o">=</span> <span class="p">{</span><span class="mi">1156563417652693958656</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">272</span><span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">--?</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*=</span><span class="mi">2</span><span class="p">,</span> <span class="n">main</span><span class="p">()</span> <span class="o">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Go ahead and run it on your machine! For lazy bums, here is the place you can see the output: <a href="http://ideone.com/UaGZDp">http://ideone.com/UaGZDp</a></p>

<p>Well, actually the output of this code depends on the machine, more specifically the <a href="http://en.wikipedia.org/wiki/Endianness">endianness</a> of the machine. Let us walk through the code step by step to understand all this.</p>

<h4 id="line-2">Line 2</h4>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">double</span> <span class="n">d</span><span class="p">[]</span><span class="o">=</span> <span class="p">{</span><span class="mi">1156563417652693958656</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">272</span><span class="p">};</span></code></pre></figure>

<p>Here we have simply declared a single dimensional double array and initialized it with two elements with some values. The numbers are specific, which we shall see later in this post.</p>

<h4 id="line-5">Line 5:</h4>
<p>This line is a fancy way of saying</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">main</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">else</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="p">);</span></code></pre></figure>

<p>Ternary operators are used here instead of an if else block to condense the code. We can clearly see that the main function is called repeatedly until d[1] becomes 0. Then we typecast the double array to a char pointer and print its value as a string using the <code class="highlighter-rouge">"%s"</code> placeholder in the <code class="highlighter-rouge">printf</code> function.</p>

<p>So when does <code class="highlighter-rouge">d[1]</code> become 0? You got it right, it’s after doubling <code class="highlighter-rouge">d[0]</code> 272 times. Now when <code class="highlighter-rouge">d[1]</code> becomes 0, <strong><code class="highlighter-rouge">d[0] = 8.77663973968813359063877158122E102</code></strong> in the <em><strong>mantissa exponent</strong></em> notation. This 64 bit double number in binary is represented as:<br />
<strong>01010101 01001111 01011001 01000101 01010110 01001111 01001100 01001001</strong></p>

<p>These are the 8 bytes (64 bits) representing the number. Here the first bit 0 denotes the sign (+ve) of the number. The next 11 bits <strong>10101010100</strong> represent the <strong>exponent</strong>, and the last 52 bits <strong>1111010110010100010101010110010011110100110001001001</strong> represent the <strong>mantissa</strong>.</p>

<p>This is an 8-byte representation (64 bits) in the IEEE754 standard and so a char pointer will read the whole thing one byte at a time, as char is 1-byte in size in the C language implementation. Now comes the role of endianness. On little endian machines, the string will be read backwards, i.e. the last byte is read first, so the bytes read in order are (binary, hex, decimal, char ascii):</p>

<ul>
  <li><code class="highlighter-rouge">01001001 = 0x49 = 73 = I</code></li>
  <li><code class="highlighter-rouge">01001100 = 0x4C = 76 = L</code></li>
  <li><code class="highlighter-rouge">01001111 = 0x4F = 79 = O</code></li>
  <li><code class="highlighter-rouge">01010110 = 0x56 = 86 = V</code></li>
  <li><code class="highlighter-rouge">01000101 = 0x45 = 69 = E</code></li>
  <li><code class="highlighter-rouge">01011001 = 0x59 = 89 = Y</code></li>
  <li><code class="highlighter-rouge">01001111 = 0x4F = 79 = O</code></li>
  <li><code class="highlighter-rouge">01010101 = 0x55 = 85 = U</code></li>
</ul>

<p>As <code class="highlighter-rouge">d[]</code> is an array, the next byte after <code class="highlighter-rouge">d[0]</code> in memory is having <code class="highlighter-rouge">d[1]</code> which is now <code class="highlighter-rouge">= 0</code>, so this acts as a <code class="highlighter-rouge">NULL</code> character, a string terminator for the <code class="highlighter-rouge">%s</code> placeholder in <code class="highlighter-rouge">printf</code>. Hence, the output of the code above is <code class="highlighter-rouge">ILOVEYOU</code>.</p>

<p>Interesting, isn’t it? You just found a geeky way to say this to the love of your life! Anyway, this interesting aspect can be used to obfuscate any string into numbers, like I did with my name. <code class="highlighter-rouge">ASEEMRAJ</code> can be obfuscated by using <code class="highlighter-rouge">d[0] = 4875566432211777.0</code> and <code class="highlighter-rouge">d[1] = 113</code>. Now go and find the magical numbers for your own strings.</p>

<p><em>Note: If float is used instead of double we have 4 bytes, hence 4 characters instead of 8.</em></p>

<hr />

  </div>

  <div class="date">
    Written on January 25, 2015
  </div>

  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:aseemraj@protonmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/aseemraj"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/aseemraj"><i class="svg-icon linkedin"></i></a>


<a href="https://www.twitter.com/aseemrb"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/2513442/aseem-raj-baranwal"><i class="svg-icon stackoverflow"></i></a>


        </footer>
      </div>
    </div>

    

  </body>
</html>
